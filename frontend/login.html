<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Registration</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        .spinner {
            border: 4px solid rgba(0, 0, 0, .1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 font-sans antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // --- API URL ---
        // Make sure this matches your project folder name
        const AUTH_API_URL = 'http://localhost/HoosWhoPoop/backend/auth/login-api.php';
        
        // --- Helper Components ---
        const LoadingSpinner = () => (
            <div className="flex justify-center items-center">
                <div className="spinner"></div>
            </div>
        );

        const ErrorMessage = ({ message, onClear }) => (
            <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-4" role="alert">
                <strong className="font-bold">Error: </strong>
                <span className="block sm:inline">{message}</span>
                <span className="absolute top-0 bottom-0 right-0 px-4 py-3" onClick={onClear}>
                    <svg className="fill-current h-6 w-6 text-red-500 cursor-pointer" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Close</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0 0 1 0 1.698z"/></svg>
                </span>
            </div>
        );

        // --- Main App Component ---
        function App() {
            const [mode, setMode] = useState('login'); // 'login' or 'register'
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);
            const [success, setSuccess] = useState(null);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError(null);
                setSuccess(null);

                if (!username || !password) {
                    setError('Username and password are required.');
                    return;
                }
                
                setLoading(true);

                try {
                    const response = await fetch(AUTH_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            action: mode,
                            username: username,
                            password: password
                        })
                    });

                    const result = await response.json();

                    if (!response.ok || result.status === 'error') {
                        throw new Error(result.message || `An error occurred with status ${response.status}`);
                    }

                    // --- Success ---
                    if (mode === 'register') {
                        setSuccess(`User '${result.user.username}' created! You can now log in.`);
                        setMode('login'); // Switch to login form
                        setUsername('');
                        setPassword('');
                    } else {
                        // Login success
                        setSuccess(`Welcome, ${result.user.username}! Redirecting to your app...`);
                        
                        // Here you would normally save a token (e.g., in localStorage)
                        // For this demo, we'll just redirect to the main app
                        setTimeout(() => {
                            window.location.href = 'index.html'; // Redirect to your main app
                        }, 2000);
                    }

                } catch (e) {
                    setError(e.message);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="flex items-center justify-center min-h-screen">
                    <div className="bg-white p-8 rounded-lg shadow-md w-full max-w-md">
                        <h1 className="text-3xl font-bold text-center mb-6 text-blue-600">
                            {mode === 'login' ? 'Sign In' : 'Create Account'}
                        </h1>
                        
                        {error && <ErrorMessage message={error} onClear={() => setError(null)} />}
                        {success && (
                            <div className="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg relative mb-4">
                                {success}
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label 
                                    htmlFor="username" 
                                    className="block text-sm font-medium text-gray-700"
                                >
                                    Username
                                </label>
                                <input
                                    type="text"
                                    id="username"
                                    value={username}
                                    onChange={(e) => setUsername(e.target.value)}
                                    className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                            <div>
                                <label 
                                    htmlFor="password" 
                                    className="block text-sm font-medium text-gray-700"
                                >
                                    Password
                                </label>
                                <input
                                    type="password"
                                    id="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="mt-1 block w-full p-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500"
                                />
                            </div>
                            
                            <div className="pt-2">
                                <button 
                                    type="submit" 
                                    disabled={loading}
                                    className="w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition disabled:bg-blue-300 flex items-center justify-center"
                                >
                                    {loading ? <LoadingSpinner /> : (mode === 'login' ? 'Login' : 'Register')}
                                </button>
                            </div>
                        </form>
                        
                        <div className="text-center mt-6">
                            <button
                                onClick={() => {
                                    setMode(mode === 'login' ? 'register' : 'login');
                                    setError(null);
                                    setSuccess(null);
                                }}
                                className="text-sm text-blue-500 hover:underline"
                            >
                                {mode === 'login' ? "Don't have an account? Register" : "Already have an account? Login"}
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // Mount the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
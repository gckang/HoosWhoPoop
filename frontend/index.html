<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hoos Who Poop</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

    <!--extracted navbar-->
    <script src="navBar.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        // --- API URLs --- 
        // CHANGE B/W LOCAL AND UVA SERVER
        const API_BASE_URL = 'http://localhost/HoosWhoPoop/backend/';
        //const API_BASE_URL = 'https://www.cs.virginia.edu/~kng4jc/HoosWhoPoop/backend/';

        const HABIT_API_URL = `${API_BASE_URL}/habit-api.php`;
        const GOAL_API_URL = `${API_BASE_URL}/goal-api.php`;
        const EVENT_API_URL = `${API_BASE_URL}/event-api.php`;
        const EVENT_FILTER_URL = `${API_BASE_URL}/event-filter.php`;
        const FRIEND_API_URL = `${API_BASE_URL}/friends-api.php`;
        const CHECK_SESSION_API_URL = `${API_BASE_URL}/auth/check-session-api.php`;
        const LOGOUT_API_URL = `${API_BASE_URL}/auth/logout-api.php`;

        // --- Components ---
        const LoadingSpinner = () => <div className="spinner"></div>;

        const ErrorMessage = ({ message, onClear }) => (
            <div className="error-message">
                <strong>Error: </strong>
                <span>{message}</span>
                <span className="close" onClick={onClear}>✖</span>
            </div>
        );

        function App() {
            const [user, setUser] = useState(null);
            const [isCheckingAuth, setIsCheckingAuth] = useState(true);
            const [habits, setHabits] = useState([]);
            const [goals, setGoals] = useState([]);
            const [events, setEvents] = useState([]);
            const [friends, setFriends] = useState([]);
            const [loading, setLoading] = useState({ habits: true, goals: true, friends: true, events: true});
            const [error, setError] = useState(null);

            useEffect(() => {
                const checkAuth = async () => {
                    try {
                        const response = await fetch(CHECK_SESSION_API_URL, { credentials: 'include' });
                        if (!response.ok) throw new Error('Not logged in');
                        const data = await response.json();
                        if (data.status === 'success') setUser(data.user);
                        else throw new Error('Not logged in');
                    } catch (e) {
                        window.location.href = 'login.html';
                    } finally { setIsCheckingAuth(false); }
                };
                checkAuth();
            }, []);

            const fetchData = useCallback(async (url, key, setter) => {
                setLoading(prev => ({ ...prev, [key]: true }));
                try {
                    const response = await fetch(url);
                    if (!response.ok) throw new Error(`HTTP error! ${response.status}`);
                    const data = await response.json();
                    setter(data);
                } catch (e) {
                    setError(`Could not fetch ${key}: ${e.message}`);
                } finally {
                    setLoading(prev => ({ ...prev, [key]: false }));
                }
            }, []);

            useEffect(() => {
                if (user) {
                    fetchData(HABIT_API_URL, 'habits', setHabits);
                    fetchData(GOAL_API_URL, 'goals', setGoals);
                    fetchData(FRIEND_API_URL, 'friends', setFriends);
                    fetchData(EVENT_API_URL, 'events', setEvents);
                }
            }, [user, fetchData]);

            const handleEventAdded = () => {
                fetchData(EVENT_API_URL, 'events', setEvents);
            };

            const handleLogout = async () => {
                try { await fetch(LOGOUT_API_URL, { method: 'POST', credentials: 'include' }); }
                finally { window.location.href = 'login.html'; }
            };

            const computeGoalProgress = useCallback(() => {
                const map = {};

                events.forEach(ev => {
                    const start = new Date(`2000-01-01T${ev.start_time}`);
                    const end = new Date(`2000-01-01T${ev.end_time}`);
                    const hours = (end - start) / (1000 * 60 * 60);

                    if (!map[ev.goal_id]) map[ev.goal_id] = 0;
                    map[ev.goal_id] += hours;
                });

                return map;
            }, [events]);

            const goalProgress = computeGoalProgress();

            const averagePercent = React.useMemo(() => {
                if (!goals.length) return 0;
                let totalPercent = 0;
                goals.forEach(goal => {
                    const prog = goalProgress[goal.goal_id] || 0;
                    totalPercent += Math.min(100, (prog / goal.goal_time) * 100);
                });
                return totalPercent / goals.length;
            }, [goals, goalProgress]);


            if (isCheckingAuth) return <LoadingSpinner />;

            return (
                <div>
                    {NavBar({user, handleLogout})}

                    {error && <ErrorMessage message={error} onClear={() => setError(null)} />}

                    <div className="content-container">
                        <div className="main-columns">
                            <div className="three-columns">
                                <HabitManager habits={habits} loading={loading.habits} setHabits={setHabits}/>
                                <EventAdder goals={goals} onEventAdded={handleEventAdded} setError={setError} />
                            </div>

                            <div className="three-columns">
                                <GoalManager goals={goals} habits={habits} loading={loading.goals} setGoals={setGoals} progress={goalProgress}/>
                                <EventDisplay goals={goals} events={events} setEvents={setEvents} loading={loading.events}/>
                            </div>

                            {/* Right column: Goal on top, Friends directly below (matching font/size) */}
                            <div className="three-columns">
                                <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
                                    <PooSprite percent={averagePercent} />
                                    {/* Use same section styles as other lists and inherit font/size */}
                                    <div style={{ width: '100%' }}>
                                        <FriendManager friends={friends} loading={loading.friends} setFriends={setFriends} />
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function NavBar({user, handleLogout}) {
            return (
                <header className="app-header">
                    <h1>HoosWhoPoop</h1>
                    <p>Hello pooper, <span className="username">{user.username}</span></p>
                    <ul className="navigation">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="events.html">Entries</a></li>
                        <li><a href="rooms.html">Rooms</a></li>
                    </ul>
                    <button className="logout-button" onClick={handleLogout}>Logout</button>
                </header>
            )
        }

        function HabitItem({ habit, onDelete, onEdit }) {
            const [isEditing, setIsEditing] = React.useState(false);
            const [editValue, setEditValue] = React.useState(habit.category);

            const handleSave = async () => {
                if (!editValue.trim()) return;
                const success = await onEdit(habit.habit_id, editValue);
                if (success) setIsEditing(false);
            };

            const handleCancel = () => {
                setIsEditing(false);
                setEditValue(habit.category);
            };

            return (
                <li className="poo-item">
                    {isEditing ? (
                        <React.Fragment>
                            <input
                                className="poo-input"
                                value={editValue}
                                onChange={e => setEditValue(e.target.value)}
                                autoFocus
                            />
                            <button onClick={handleSave} className="icon-button">✔</button>
                            <button onClick={handleCancel} className="icon-button">✖</button>
                        </React.Fragment>
                    ) : (
                        <React.Fragment>
                            <span className="habit-text">{habit.category}</span>
                            <span className="list-actions">
                                <i
                                    className="fa-solid fa-pen edit-icon"
                                    onClick={() => setIsEditing(true)}
                                ></i>
                                <i
                                    className="fa-solid fa-trash delete-icon"
                                    onClick={() => onDelete(habit.habit_id)}
                                ></i>
                            </span>
                        </React.Fragment>
                    )}
                </li>
            );
        }

        function HabitManager({ habits, loading, setHabits }) {
            const handleDelete = async (habitId) => {
                try {
                    const res = await fetch(HABIT_API_URL, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ habit_id: habitId })
                    });
                    const result = await res.json();
                    if (result.status !== 'success') throw new Error(result.message);

                    setHabits(prev => prev.filter(h => h.habit_id !== habitId));
                    return true;
                } catch (e) {
                    console.error(e);
                    return false;
                }
            };

            const handleEdit = async (habitId, newCategory) => {
                try {
                    const res = await fetch(HABIT_API_URL, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ habit_id: habitId, category: newCategory })
                    });
                    const result = await res.json();
                    if (result.status !== 'success') throw new Error(result.message);

                    setHabits(prev =>
                        prev.map(h => h.habit_id === habitId ? { ...h, category: newCategory } : h)
                    );
                    return true;
                } catch (e) {
                    console.error(e);
                    return false;
                }
            };

            const [newHabit, setNewHabit] = React.useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!newHabit.trim()) return;
                try {
                    const response = await fetch(HABIT_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ category: newHabit })
                    });
                    const result = await response.json();
                    if (!response.ok || result.status === 'error') throw new Error(result.message || 'Failed to add habit');

                    setNewHabit('');
                    setHabits(prev => [result.habit, ...prev]); // Add new habit at top
                } catch (e) {
                    console.error(e);
                }
            };

            return (
                <section className="habit-section">
                    <h2>Habits</h2>
                    <form onSubmit={handleSubmit} className="poo-form">
                        <input
                            value={newHabit}
                            onChange={e => setNewHabit(e.target.value)}
                            placeholder="Add new habit"
                            className="poo-input"
                        />
                        <button type="submit" className="add-button">Add Habit</button>
                    </form>

                    {loading ? <div className="spinner"></div> :
                        <ul className="list">
                            {habits.map(h => (
                                <HabitItem
                                    key={h.habit_id}
                                    habit={h}
                                    onDelete={handleDelete}
                                    onEdit={handleEdit}
                                />
                            ))}
                        </ul>
                    }
                </section>
            );
        }

        function GoalItem({ goal, habits, onDelete, onEdit, progress }) {
            const [isEditing, setIsEditing] = React.useState(false);

            const [editHabit, setEditHabit] = React.useState(goal.habit_id);
            const [editDeadline, setEditDeadline] = React.useState(goal.deadline);
            const [editTime, setEditTime] = React.useState(goal.goal_time);

            const handleSave = async () => {
                if (!editHabit || !editDeadline || !editTime) return;

                const success = await onEdit(
                    goal.goal_id,
                    parseInt(editHabit),
                    editDeadline,
                    parseInt(editTime)
                );

                if (success) setIsEditing(false);
            };

            const handleCancel = () => {
                setIsEditing(false);
                setEditHabit(goal.habit_id);
                setEditDeadline(goal.deadline);
                setEditTime(goal.goal_time);
            };

            const getHabitName = (id) => {
                if (!habits || habits.length === 0) return "Loading...";
                const numericId = parseInt(id);
                const habit = habits.find(h => parseInt(h.habit_id) === numericId);
                return habit ? habit.category : "Unknown";
            };

            const percent = Math.min(
                Math.round((progress / goal.goal_time) * 100),
                100
            )

            const [selectedHabit, setSelectedHabit] = useState('');
            const [deadline, setDeadline] = useState('');
            const [goalTime, setGoalTime] = useState('');

            return (
                <li className="poo-item">
                    {isEditing ? (
                        <React.Fragment>
                            <select
                                className="poo-select"
                                value={editHabit}
                                onChange={(e) => setEditHabit(e.target.value)}
                            >
                                {habits.map((h) => (
                                    <option key={h.habit_id} value={h.habit_id}>
                                        {h.category}
                                    </option>
                                ))}
                            </select>

                            <input
                                type="date"
                                className="poo-input"
                                value={editDeadline}
                                onChange={(e) => setEditDeadline(e.target.value)}
                            />

                            <input
                                type="number"
                                className="poo-input"
                                value={editTime}
                                onChange={(e) => setEditTime(e.target.value)}
                            />

                            <button onClick={handleSave} className="icon-button">✔</button>
                            <button onClick={handleCancel} className="icon-button">✖</button>
                        </React.Fragment>
                    ) : (
                        <React.Fragment>
                            <div className="goal-info">
                                <span className="goal-text">
                                    {getHabitName(goal.habit_id)} — {goal.goal_time} hrs by {goal.deadline}
                                </span>

                                <div className="progress-container">
                                    <div
                                        className="progress-bar"
                                        style={{ width: percent + "%" }}
                                    ></div>
                                </div>

                                <p className="progress-text">
                                    {progress.toFixed(1)} / {goal.goal_time} hrs
                                </p>
                            </div>

                            <span className="list-actions">
                                <i
                                    className="fa-solid fa-pen edit-icon"
                                    onClick={() => setIsEditing(true)}
                                ></i>
                                <i
                                    className="fa-solid fa-trash delete-icon"
                                    onClick={() => onDelete(goal.goal_id)}
                                ></i>
                            </span>
                        </React.Fragment>
                    )}
                </li>
            );
        }

        function GoalManager({ goals, habits, loading, setGoals, progress }) {
            const [selectedHabit, setSelectedHabit] = React.useState("");
            const [deadline, setDeadline] = React.useState("");
            const [goalTime, setGoalTime] = React.useState("");

            // ADD GOAL
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!selectedHabit || !deadline || !goalTime) return;

                try {
                    const res = await fetch(GOAL_API_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            habit_id: parseInt(selectedHabit),
                            deadline,
                            goal_time: parseInt(goalTime)
                        }),
                    });

                    const result = await res.json();
                    if (!res.ok || result.status === "error")
                        throw new Error(result.message);

                    setGoals((prev) => [result.goal, ...prev]);

                    setSelectedHabit("");
                    setDeadline("");
                    setGoalTime("");
                } catch (e) {
                    console.error(e);
                }
            };

            // DELETE GOAL
            const handleDelete = async (goalId) => {
                try {
                    const res = await fetch(GOAL_API_URL, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ goal_id: goalId }),
                    });

                    const result = await res.json();
                    if (result.status !== "success") throw new Error(result.message);

                    setGoals((prev) => prev.filter((g) => g.goal_id !== goalId));
                } catch (e) {
                    console.error(e);
                }
            };

            // EDIT GOAL
            const handleEdit = async (goalId, habitId, deadline, goalTime) => {
                try {
                    const res = await fetch(GOAL_API_URL, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            goal_id: goalId,
                            habit_id: habitId,
                            deadline,
                            goal_time: goalTime,
                        }),
                    });

                    const result = await res.json();
                    if (result.status !== "success") throw new Error(result.message);

                    setGoals((prev) =>
                        prev.map((g) =>
                            g.goal_id === goalId
                                ? { ...g, habit_id: habitId, deadline, goal_time: goalTime }
                                : g
                        )
                    );

                    return true;
                } catch (e) {
                    console.error(e);
                    return false;
                }
            };

            return (
                <section className="goal-section">
                    <h2>Goals</h2>

                    {/* ADD GOAL */}
                    <form onSubmit={handleSubmit} className="poo-form">
                        <select
                            value={selectedHabit}
                            onChange={(e) => setSelectedHabit(e.target.value)}
                            className="poo-select"
                        >
                            <option value="">Select habit...</option>
                            {habits.map((h) => (
                                <option key={h.habit_id} value={h.habit_id}>
                                    {h.category}
                                </option>
                            ))}
                        </select>

                        <input
                            type="date"
                            value={deadline}
                            onChange={(e) => setDeadline(e.target.value)}
                            className="poo-input"
                        />

                        <input
                            type="number"
                            value={goalTime}
                            onChange={(e) => setGoalTime(e.target.value)}
                            className="poo-input"
                            placeholder="Hours"
                        />

                        <button className="add-button">Add Goal</button>
                    </form>

                    {/* LIST OF GOALS */}
                    {loading ? (
                        <div className="spinner"></div>
                    ) : (
                        <ul className="list">
                            {goals.map((g) => (
                                <GoalItem
                                    key={g.goal_id}
                                    goal={g}
                                    habits={habits}
                                    onDelete={handleDelete}
                                    onEdit={handleEdit}
                                    progress={progress[g.goal_id] || 0}
                                />
                            ))}
                        </ul>
                    )}
                </section>
            );
        }

        // Friend item - same style as habit item but no edit button
        function FriendItem({ friend, onDelete }) {
            return (
                <li className="poo-item">
                    <span className="habit-text">{friend.username || friend.name || friend.display_name}</span>
                    <span className="list-actions">
                        <i
                            className="fa-solid fa-trash delete-icon"
                            onClick={() => onDelete(friend.friend_id)}
                        ></i>
                    </span>
                </li>
            );
        }

        // Friend manager - styled like habit-section, placed under right goal column
        function FriendManager({ friends, loading, setFriends }) {
            const [newFriend, setNewFriend] = useState('');

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!newFriend.trim()) return;
                try {
                    const response = await fetch(FRIEND_API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ friend_id: newFriend })
                    });
                    const result = await response.json();
                    if (!response.ok || result.status === 'error') throw new Error(result.message || 'Failed to add friend');

                    setNewFriend('');
                    setFriends(prev => [result.friend, ...prev]);
                } catch (e) {
                    console.error(e);
                }
            };

            const handleDelete = async (friendId) => {
                try {
                    const res = await fetch(FRIEND_API_URL, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ friend_id: friendId })
                    });
                    const result = await res.json();
                    if (result.status !== 'success') throw new Error(result.message);

                    setFriends(prev => prev.filter(f => f.friend_id !== friendId));
                } catch (e) {
                    console.error(e);
                }
            };

            return (
                <section className="habit-section"> {/* reuse habit-section styles for identical look */}
                    <h2>Friends</h2>
                    <form onSubmit={handleSubmit} className="poo-form">
                        <input
                            value={newFriend}
                            onChange={e => setNewFriend(e.target.value)}
                            placeholder="Add friend (user ID)"
                            className="poo-input"
                        />
                        <button type="submit" className="add-button">Add</button>
                    </form>

                    {loading ? <div className="spinner"></div> :
                        <ul className="list">
                            {friends.map(f => (
                                <FriendItem
                                    key={f.friend_id}
                                    friend={f}
                                    onDelete={handleDelete}
                                />
                            ))}
                        </ul>
                    }
                </section>
            );
        }

        function EventAdder({goals, onEventAdded, setError}) {
            const [selectedGoal,setSelectedGoal] = useState('');
            const [day,setDay] = useState('');
            const [startTime,setStartTime] = useState('');
            const [endTime,setEndTime] = useState('');

            const handleSubmit = async e => {
                e.preventDefault();
                if(!selectedGoal || !day || !startTime || !endTime){
                    setError("Please fill out all event fields.");
                    return;
                }
                try{
                    const res = await fetch(EVENT_API_URL, {
                        method:'POST',
                        headers:{'Content-Type':'application/json'},
                        body: JSON.stringify({
                            action: "post_events",
                            goal_id: parseInt(selectedGoal),
                            day,
                            start_time: startTime,
                            end_time: endTime
                        })
                    });
                    const data = await res.json();
                    if(!res.ok || data.status === 'error') 
                        throw new Error(data.message || 'Failed to add event.');
                    
                    onEventAdded();
                    setSelectedGoal('');
                    setDay('');
                    setStartTime('');
                    setEndTime('');
                } catch(e) { 
                    setError(`Failed to add event: ${e.message}`);
                }
            };

            return (
                <section className="habit-section">
                    <h2>Track Events</h2>
                    <form onSubmit={handleSubmit} className="poo-form">
                        <select value={selectedGoal} onChange={e=>setSelectedGoal(e.target.value)} className="poo-select">
                            <option value="">Select a goal to log time for...</option>
                            {goals.map(g => (
                                <option key={g.goal_id} value={g.goal_id}>
                                    {g.category} (by {g.deadline})
                                </option>
                            ))}
                        </select>

                        <input type="date" value={day} onChange={e=>setDay(e.target.value)} className="poo-input"/>

                        <div className="flex space-x-2">
                            <input type="time" value={startTime} onChange={e=>setStartTime(e.target.value)} className="poo-input"/>
                            <input type="time" value={endTime} onChange={e=>setEndTime(e.target.value)} className="poo-input"/>
                        </div>

                        <button type="submit" className="add-button">Add Event</button>
                    </form>
                </section>
            );
        }

        function EventDisplay({goals, events, setEvents, loading}) {
            const [selectedGoal, setSelectedGoal] = useState('');
            const [selectedDate, setSelectedDate] = useState('');
            const [editingEventId, setEditingEventId] = useState(null);
            const [editData, setEditData] = useState({ start_time: '', end_time: '', day: '', goal_id: '' });

            //console.log("Events loaded:", events);
            
            const handleFilter = async (e) => {
                e.preventDefault();
                try {
                    const response = await fetch(EVENT_FILTER_URL, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            action: "filter_events",
                            goal_id: selectedGoal ? parseInt(selectedGoal) : null,
                            day: selectedDate || null
                        })
                    });

                    const result = await response.json();
                    if(!response.ok || result.status === "error") throw new Error(result.message);

                    setEvents(result.events);

                } catch(e) {
                    console.error(e);
                }
            };

            const startEdit = (event) => {
                setEditingEventId(event.event_id);
                setEditData({
                    event_id: event.event_id,
                    start_time: event.start_time,
                    end_time: event.end_time,
                    day: event.day,
                    goal_id: event.goal_id
                });
            };

            const cancelEdit = () => {
                setEditingEventId(null);
                setEditData({ event_id: '', start_time: '', end_time: '', day: '', goal_id: '' });
            };

            const saveEdit = async (eventId) => {
                const goalIdInt = parseInt(editData.goal_id);

                try {
                    const res = await fetch(EVENT_API_URL, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ 
                            event_id: eventId,
                            start_time: editData.start_time,
                            end_time: editData.end_time,
                            day: editData.day,
                            goal_id: goalIdInt
                        })
                    });
                    const result = await res.json();
                    if(result.status !== 'success') throw new Error(result.message);

                    setEvents(prev => prev.map(ev => ev.event_id === eventId ? { ...ev, ...editData } : ev));
                    cancelEdit();
                } catch(e) {
                    console.error(e);
                }
            };

            const deleteEvent = async (eventId) => {
                //console.log("Deleting event:", eventId);
                try {
                    const res = await fetch(EVENT_API_URL, {
                        method: "DELETE",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ event_id: eventId })
                    });
                    const result = await res.json();
                    if(result.status !== 'success') throw new Error(result.message);

                    setEvents(prev => prev.filter(ev => ev.event_id !== eventId));
                } catch(e) {
                    console.error(e);
                }
            };

            return (
                <section className="goal-section">
                    <h2>Existing Events</h2>

                    <form onSubmit={handleFilter} className="poo-form">
                        <select value={selectedGoal} onChange={e => setSelectedGoal(e.target.value)} className="poo-select">
                            <option value="">Filter by goal...</option>
                            {goals.map(g => (
                                <option key={g.goal_id} value={g.goal_id}>
                                    {g.category} (by {g.deadline})
                                </option>
                            ))}
                        </select>

                        <input type="date" value={selectedDate} onChange={e => setSelectedDate(e.target.value)} className="poo-input"/>
                        <button type="submit" className="add-button">Filter</button>
                    </form>

                    {loading ? <LoadingSpinner/> : (
                        <ul className="list">
                            {events.map(ev => (
                                <li key={ev.event_id} className="poo-item">
                                    {editingEventId === ev.event_id ? (
                                        <div className="edit-event">
                                            <select value={editData.goal_id} onChange={e => setEditData({...editData, goal_id: e.target.value})}>
                                                {goals.map(g => (
                                                    <option key={g.goal_id} value={g.goal_id}>
                                                        {g.category} (by {g.deadline})
                                                    </option>
                                                ))}
                                            </select>
                                            <input type="date" value={editData.day} onChange={e => setEditData({...editData, day: e.target.value})}/>
                                            <input type="time" value={editData.start_time} onChange={e => setEditData({...editData, start_time: e.target.value})}/>
                                            <input type="time" value={editData.end_time} onChange={e => setEditData({...editData, end_time: e.target.value})}/>
                                            <button onClick={() => saveEdit(ev.event_id)} className="icon-button">✔</button>
                                            <button onClick={cancelEdit} className="icon-button">✖</button>
                                        </div>
                                    ) : (
                                        <React.Fragment>
                                            {ev.category}: {ev.day} from {ev.start_time} to {ev.end_time}
                                            <span className="list-actions">
                                                <i className="fa-solid fa-pen edit-icon" onClick={() => startEdit(ev)}></i>
                                                <i className="fa-solid fa-trash delete-icon" onClick={() => deleteEvent(ev.event_id)}></i>
                                            </span>
                                        </React.Fragment>
                                    )}
                                </li>
                            ))}
                        </ul>
                    )}
                </section>
            );
        }

        function PooSprite({ percent }) {
            let pooImage = "";

            if (percent < 25) pooImage = "../media/miserable_poo.png";
            else if (percent < 50) pooImage = "../media/sad_poo.png";
            else if (percent < 75) pooImage = "../media/neutral_poo.png";
            else pooImage = "../media/happy_poo.png";

            return (
                <img 
                    src={pooImage}
                    alt="Poo Sprite"
                    className="poo-sprite"
                />
            );
        }




        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
